{% extends 'teacher_page/gv_base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/course_management.css' %}">
{% endblock %}

{% block content %}


<!-- Đã xóa sidebar và sidebar-menu, chỉ giữ lại phần main-content và các chức năng -->
<div class="main-content">
    <div class="page-header">
        <h2>Danh sách các khóa học</h2>
        <div class="header-actions">
            <input type="text" placeholder="Nhập từ khoá tìm kiếm">
            <button class="add-class-btn" title="Nhấn để thêm mới lớp học">Tạo mới</button>
        </div>
    </div>
    <table class="class-table">
        <thead>
            <tr>
                <th>Tên khóa học</th>
                <th>Trạng thái</th>
                <th>Giáo viên</th>
                <th>Học phí</th>
                <th>Ngày bắt đầu</th>
                <th>Ngày kết thúc</th>
                <th>Lịch học</th>
                <th>Số buổi</th>
                <th>Số buổi đã học</th>
                <th>Giáo trình</th>
                <th>Ghi chú</th>
                <th>sô người tham gia</th>
                <th>Tính năng</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Python 1A</td>
                <td>Đang hiện</td>
                <td> Minh Đăng</td>
                <td>10,500,000</td>
                <td>27-02-2025</td>
                <td>25-05-2025</td>
                <td>Thứ 2-thứ 7 18:00-19:30</td>
                <td>4-5</td>
                <td>24</td>
                <td>13</td>
                <td>Đây là chương trình học Python chuẩn quốc tế</td>
                <td>1000</td>
                <td>
                    <button class="edit-btn">Sửa</button>
                    <button class="delete-btn">Xóa</button>
                </td>
            </tr>
            <!-- Thêm các dòng khác tương tự -->
        </tbody>
    </table>
</div>
<!-- Modal cho Tạo mới/Sửa lớp học -->
<div id="classModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close-modal" id="closeModal">&times;</span>
        <h3 id="modalTitle">Tạo mới lớp học</h3>
        <form id="classForm">
            <input type="text" id="className" placeholder="Tên khóa học" required><br>
            <input type="text" id="status" placeholder="Trạng thái" required><br>
            <input type="text" id="teacher" placeholder="Giáo viên" required><br>
            <input type="number" id="fee" placeholder="Học phí" required><br>
            <input type="date" id="startDate" placeholder="Ngày bắt đầu"><br>
            <input type="date" id="endDate" placeholder="Ngày kết thúc"><br>
            <input type="text" id="schedule" placeholder="Lịch học"><br>
            <input type="number" id="sessions" placeholder="Số buổi"><br>
            <input type="number" id="sessionsDone" placeholder="Số buổi đã học"><br>
            <input type="text" id="curriculum" placeholder="Giáo trình"><br>
            <input type="text" id="note" placeholder="Ghi chú"><br>
            <input type="number" id="participants" placeholder="Số người tham gia"><br>
            <button type="submit" id="saveBtn">Lưu</button>
        </form>
    </div>
</div>
<script>
// Hiển thị modal tạo mới
const addBtn = document.querySelector('.add-class-btn');
const modal = document.getElementById('classModal');
const closeModal = document.getElementById('closeModal');
const modalTitle = document.getElementById('modalTitle');
const classForm = document.getElementById('classForm');
let editingRow = null;

addBtn.onclick = function() {
    modalTitle.textContent = 'Tạo mới lớp học';
    classForm.reset();
    editingRow = null;
    modal.style.display = 'block';
};
closeModal.onclick = function() {
    modal.style.display = 'none';
};
window.onclick = function(event) {
    if (event.target == modal) modal.style.display = 'none';
};

// Sửa lớp học
const editBtns = document.querySelectorAll('.edit-btn');
editBtns.forEach(function(btn) {
    btn.onclick = function() {
        const row = btn.closest('tr');
        editingRow = row;
        modalTitle.textContent = 'Sửa lớp học';
        document.getElementById('className').value = row.children[0].textContent.trim();
        document.getElementById('status').value = row.children[1].textContent.trim();
        document.getElementById('teacher').value = row.children[2].textContent.trim();
        document.getElementById('fee').value = row.children[3].textContent.trim().replace(/[^\d]/g, '');
        document.getElementById('startDate').value = row.children[4].textContent.trim().split('-').reverse().join('-');
        document.getElementById('endDate').value = row.children[5].textContent.trim().split('-').reverse().join('-');
        document.getElementById('schedule').value = row.children[6].textContent.trim();
        document.getElementById('sessions').value = row.children[7].textContent.trim();
        document.getElementById('sessionsDone').value = row.children[8].textContent.trim();
        document.getElementById('curriculum').value = row.children[9].textContent.trim();
        document.getElementById('note').value = row.children[10].textContent.trim();
        document.getElementById('participants').value = row.children[11].textContent.trim();
        modal.style.display = 'block';
    };
});

// Lưu lớp học (tạo mới hoặc sửa)
classForm.onsubmit = function(e) {
    e.preventDefault();
    const values = [
        document.getElementById('className').value,
        document.getElementById('status').value,
        document.getElementById('teacher').value,
        document.getElementById('fee').value,
        document.getElementById('startDate').value ? document.getElementById('startDate').value.split('-').reverse().join('-') : '',
        document.getElementById('endDate').value ? document.getElementById('endDate').value.split('-').reverse().join('-') : '',
        document.getElementById('schedule').value,
        document.getElementById('sessions').value,
        document.getElementById('sessionsDone').value,
        document.getElementById('curriculum').value,
        document.getElementById('note').value,
        document.getElementById('participants').value
    ];
    if (editingRow) {
        for (let i = 0; i < values.length; i++) {
            editingRow.children[i].textContent = values[i];
        }
    } else {
        const table = document.querySelector('.class-table tbody');
        const newRow = table.insertRow();
        let html = '';
        for (let i = 0; i < values.length; i++) {
            html += `<td>${values[i]}</td>`;
        }
        html += `<td><button class='edit-btn'>Sửa</button> <button class='delete-btn'>Xóa</button></td>`;
        newRow.innerHTML = html;
        newRow.querySelector('.edit-btn').onclick = editBtns[0].onclick;
        newRow.querySelector('.delete-btn').onclick = deleteHandler;
    }
    modal.style.display = 'none';
};

// Xóa lớp học
function deleteHandler() {
    if (confirm('Bạn có chắc muốn xóa lớp này?')) {
        this.closest('tr').remove();
    }
}
const deleteBtns = document.querySelectorAll('.delete-btn');
deleteBtns.forEach(function(btn) {
    btn.onclick = deleteHandler;
});
</script>
<style>
.modal {
    position: fixed; z-index: 999; left: 0; top: 0; width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;
}
.modal-content {
    background: #fff; padding: 24px 32px; border-radius: 8px; min-width: 300px; position: relative;
}
.close-modal {
    position: absolute; right: 12px; top: 8px; font-size: 1.5em; cursor: pointer; color: #888;
}
#classForm input { width: 90%; margin: 8px 0; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
#saveBtn { background: #6ec1e4; color: #fff; border: none; border-radius: 4px; padding: 8px 18px; font-size: 1em; cursor: pointer; margin-top: 8px; }
#saveBtn:hover { background: #4fa3c7; }
</style>
{% endblock %}
