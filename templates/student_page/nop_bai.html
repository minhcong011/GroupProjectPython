{% extends 'student_page/student_base.html' %}
{% load static %}

{% block title %}
{% if assignment %}
Ná»™p bÃ i: {{ assignment.tieu_de }}
{% else %}
Ná»™p bÃ i táº­p
{% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/nop_bai.css' %}">
{% endblock %}

{% block content %}
<div class="nopbai-container">
  <div class="nopbai-header">
    <button class="back-btn" onclick="window.location.href='{% url 'studentapp:assignment_list' %}'">
      ğŸ”™ Quay láº¡i danh sÃ¡ch bÃ i táº­p
    </button>
    
    {% if assignment %}
    <h2 class="assignment-title">{{ assignment.tieu_de }}</h2>
    
    <div class="assignment-info">
      <div class="info-row">
        <strong>Deadline:</strong> {{ assignment.han_nop|date:'d/m/Y H:i' }}
      </div>
      <div class="info-row">
        <strong>Loáº¡i bÃ i táº­p:</strong> {{ assignment.get_loai_baitap_display }}
      </div>
      <div class="info-row">
        <strong>Giáº£ng viÃªn:</strong> {{ assignment.nguoi_tao.get_full_name|default:assignment.nguoi_tao.username }}
      </div>
      <div class="info-row">
        <strong>NgÃ y táº¡o:</strong> {{ assignment.ngay_tao|date:'d/m/Y H:i' }}
      </div>
    </div>
    
    <div class="assignment-description">
      <h3>Äá» bÃ i:</h3>
      <div class="description-content">
        {{ assignment.mo_ta|linebreaks }}
      </div>
    </div>
    {% else %}
    <h2 class="assignment-title">Ná»™p bÃ i táº­p</h2>
    <div class="no-assignment">
      <p>Vui lÃ²ng chá»n bÃ i táº­p cá»¥ thá»ƒ Ä‘á»ƒ ná»™p bÃ i.</p>
    </div>
    {% endif %}
  </div>

  {% if assignment %}
  <div class="submission-section">
    <h3>Upload file Ä‘á»ƒ ná»™p bÃ i</h3>
    
    {% if message %}
    <div class="alert alert-success">
      {{ message }}
    </div>
    {% endif %}
    
    {% if error %}
    <div class="alert alert-error">
      {{ error }}
    </div>
    {% endif %}
    
    {% if submitted_file %}
    <div class="alert alert-info">
      <strong>File Ä‘Ã£ ná»™p:</strong> {{ submitted_file.name }}<br>
      {% if submitted_file.size %}<strong>KÃ­ch thÆ°á»›c:</strong> {{ submitted_file.size|filesizeformat }}<br>{% endif %}
      <strong>Thá»i gian:</strong> {{ submitted_file.time|date:'d/m/Y H:i' }}
    </div>
    {% endif %}
    
    <form method="post" enctype="multipart/form-data" class="submission-form">
      {% csrf_token %}
      <div class="form-group">
        <label for="file"><strong>Chá»n tá»‡p Ä‘á»ƒ ná»™p:</strong></label>
        <input type="file" id="file" name="file" accept=".py,.pl,.zip,.rar,.pdf,.doc,.docx,.txt" required>
        <div class="file-note">
          Há»— trá»£ cÃ¡c Ä‘á»‹nh dáº¡ng: .py, .pl, .zip, .rar, .pdf, .doc, .docx, .txt (tá»‘i Ä‘a 10MB)
        </div>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="submit-btn">
          ğŸ“¤ Ná»™p bÃ i
        </button>
        <button type="button" class="cancel-btn" onclick="window.location.href='{% url 'studentapp:assignment_list' %}'">
          âœ–ï¸ Há»§y
        </button>
      </div>
    </form>
    
    <div class="submission-status">
      <h4>Tráº¡ng thÃ¡i ná»™p bÃ i:</h4>
      <div class="status-info">
        {% if submitted_file %}
        <span class="status submitted">âœ… ÄÃ£ ná»™p bÃ i</span><br>
        <span class="last-updated">Láº§n cáº­p nháº­t cuá»‘i: {{ submitted_file.time|date:'H:i d/m/Y' }}</span>
        {% else %}
        <span class="status pending">â³ ChÆ°a ná»™p bÃ i</span><br>
        <span class="deadline-warning">
          {% now "Y-m-d H:i" as current_time %}
          {% if assignment.han_nop|date:"Y-m-d H:i" < current_time %}
          âš ï¸ ÄÃ£ quÃ¡ háº¡n ná»™p bÃ i
          {% else %}
          ğŸ“… CÃ²n láº¡i: {{ assignment.han_nop|timeuntil }}
          {% endif %}
        </span>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}